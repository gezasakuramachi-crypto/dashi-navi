<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta
    name="viewport"
    content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover"
  />
  <title>鹿島神宮 神幸祭 山車ナビ</title>
  <meta name="theme-color" content="#000000">

  <style>
    :root{
      --rail-gap: 10px;
      --icon-size: 36px;     /* 下段メニューのアイコン高さ ≒ ヘッダー画像の高さ */
      --footer-h: 64px;      /* 下段メニューバーの高さ（アイコン＋文字＋余白） */
      --header-h: calc(var(--icon-size) + 10px); /* ヘッダーの高さ（画像高さ＋少し余白） */
      --safe-bottom: env(safe-area-inset-bottom, 0px);
      --safe-top: env(safe-area-inset-top, 0px);
      --panel-pad: 10px;
      --z-ui: 20;
      --z-rail: 25;
      --z-panel: 30;
      --z-toast: 40;
      --shadow-2: 0 6px 20px rgba(0,0,0,.25);
    }

    html, body {
      height: 100%;
      margin: 0;
      background: #000;
      color: #fff;
      -webkit-font-smoothing: antialiased;
      font-family: system-ui, -apple-system, "Hiragino Kaku Gothic ProN", "Segoe UI", Roboto, "Noto Sans JP", Arial, "Meiryo", sans-serif;
    }

    /* ヘッダー（タイトル画像は左寄せ、縦は下段アイコン程度） */
    #appHeader{
      position: fixed;
      inset: var(--safe-top) 0 auto 0;
      height: var(--header-h);
      display: flex;
      align-items: center;
      padding: 4px 10px;
      z-index: var(--z-ui);
      background: rgba(0,0,0,.75);
      backdrop-filter: blur(6px);
      -webkit-backdrop-filter: blur(6px);
      border-bottom: 1px solid rgba(255,255,255,.06);
    }
    .title-logo img{
      height: var(--icon-size);
      width: auto;
      object-fit: contain;
      display: block;
    }

    /* 右上：交通規制ヘッダー（2行） */
    #trafficHeader{
      position: fixed;
      top: calc(var(--safe-top) + 6px);
      right: 8px;
      z-index: var(--z-ui);
      text-align: right;
      user-select: none;
    }
    #trafficHeader .tt{
      display: inline-block;
      padding: 6px 8px;
      line-height: 1.1;
      background: rgba(0,0,0,.6);
      border: 1px solid rgba(255,255,255,.18);
      border-radius: 8px;
      box-shadow: var(--shadow-2);
      font-weight: 700;
      font-size: 14px;  /* ご指定：フォント1段階UP 相当 */
    }
    #trafficHeader .sub{
      margin-top: 2px;
      font-weight: 600;
      font-size: 12px;
      color: #ffd6d6;
    }

    /* 右上：交通規制メニューウインドウ（開閉トグル対象） */
    #trafficPanel{
      position: fixed;
      top: calc(var(--safe-top) + var(--header-h) + 8px);
      right: 8px;
      z-index: var(--z-panel);
      width: min(260px, 70vw);
      max-height: 60vh;
      overflow: auto;
      padding: var(--panel-pad);
      background: rgba(0,0,0,.70);          /* 透過処理のみ（ご指定） */
      border: 1px solid rgba(255,255,255,.18);
      border-radius: 10px;
      backdrop-filter: blur(6px);
      -webkit-backdrop-filter: blur(6px);
      box-shadow: var(--shadow-2);
      display: none; /* toggle表示 */
    }
    #trafficPanel.open{ display:block; }

    /* 左レール（インフォ/トイレ/パーキング のみ） */
    #leftRail{
      position: fixed;
      top: calc(var(--safe-top) + var(--header-h) + var(--rail-gap));
      left: 10px;
      display: flex;
      flex-direction: column;
      gap: var(--rail-gap);
      z-index: var(--z-rail);
    }
    .rail-btn{
      display:flex; align-items:center; gap:6px;
      background: rgba(0,0,0,.6);
      border: 1px solid rgba(255,255,255,.18);
      border-radius: 999px;
      padding: 6px 10px 6px 6px;
      box-shadow: var(--shadow-2);
      min-height: 42px;
    }
    .rail-btn img{
      height: 26px; width:auto; display:block;
    }
    .rail-btn .label{ font-size: 13px; font-weight:600; }

    /* Mapコンテナ：ヘッダー＆フッターを除いた高さで固定 */
    #map{
      position: fixed;
      top: calc(var(--safe-top) + var(--header-h));
      left: 0;
      right: 0;
      bottom: calc(var(--safe-bottom) + var(--footer-h));
      background: #c8e6ff; /* 読み込み前の下地（真っ青固着の見分け用） */
      z-index: 1;
    }

    /* 下段メニュー（ボトムナビ）：アイコン上の謎の余白は発生しないよう line-height/高さを厳密化 */
    #bottomNav{
      position: fixed;
      left: 0; right: 0;
      bottom: 0;
      height: calc(var(--footer-h) + var(--safe-bottom));
      padding-bottom: var(--safe-bottom);
      background: rgba(0,0,0,.92);
      border-top: 1px solid rgba(255,255,255,.08);
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      align-items: center;
      z-index: var(--z-ui);
    }
    .nav-btn{
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 4px;
      min-width: 0;
      height: var(--footer-h);
      text-align: center;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
    }
    .nav-btn img{
      height: var(--icon-size);
      width: auto;
      display:block;
    }
    .nav-btn .text{
      margin: 0;
      font-size: 12px;  /* ラベル小さめで2行化を避ける */
      line-height: 1.0;
      font-weight: 700;
      color: #fff;
    }
    .nav-btn:active{ filter: brightness(1.15); }

    /* トースト */
    #toast{
      position: fixed;
      left: 50%; transform: translateX(-50%);
      bottom: calc(var(--footer-h) + var(--safe-bottom) + 12px);
      background: rgba(20,20,20,.95);
      color:#fff; padding: 10px 12px;
      border-radius: 10px;
      font-size: 13px;
      z-index: var(--z-toast);
      display:none;
      box-shadow: var(--shadow-2);
      border: 1px solid rgba(255,255,255,.12);
    }

    /* InfoWindow（山車）内のボタン */
    .iw{
      min-width: 180px;  /* ご指定：必要最低限サイズに */
      max-width: 220px;
      font-size: 14px;
    }
    .iw .title{ font-weight: 800; margin-bottom: 4px; }
    .iw .status{ font-weight: 700; color: #ffd6d6; margin-bottom: 6px; }
    .iw .row{
      display:flex; gap: 6px; align-items:center; justify-content:flex-start;
    }
    .btn{
      display:inline-block;
      padding: 8px 10px;
      background:#fff;
      color:#111;
      border-radius: 8px;
      border: none;
      font-weight: 800;
      text-decoration: none;
      box-shadow: 0 2px 10px rgba(0,0,0,.18);
    }
    .btn.secondary{
      background: #ffeef0;
      color:#7a0921;
    }

    /* ヘルプオーバーレイ（簡易） */
    #helpOverlay{
      position: fixed; inset:0;
      background: rgba(0,0,0,.75);
      display: none;
      align-items: center; justify-content: center;
      z-index: var(--z-panel);
      padding: 16px;
    }
    #helpOverlay .box{
      width: min(680px, 92vw);
      max-height: 80vh; overflow: auto;
      background: rgba(0,0,0,.82);
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 12px; padding: 14px;
      box-shadow: var(--shadow-2);
    }
    #helpOverlay .close{
      margin-top: 10px;
      text-align: right;
    }
    #helpOverlay .close .btn{ background:#fff; }

    /* iOSの妙な余白対策（行高・画像のdisplay:blockはすでに対応） */

    @media (max-width: 370px){
      :root{
        --icon-size: 34px;
        --footer-h: 62px;
      }
      #trafficPanel{ width: min(240px, 74vw); }
      .iw{ max-width: 200px; }
    }
  </style>
</head>
<body>
  <!-- ヘッダー：タイトル画像（左寄せ・縦は下段アイコン程度） -->
  <header id="appHeader">
    <div class="title-logo">
      <!-- ここはご指定の画像URLをそのまま使用できます -->
      <img src="mark/title.png" alt="鹿島神宮 神幸祭 山車ナビ タイトル">
    </div>
  </header>

  <!-- 右上：交通規制ヘッダー（2行） -->
  <div id="trafficHeader" aria-live="polite">
    <div class="tt">
      <div>交通規制</div>
      <div class="sub" id="trafficSub">自動更新</div>
    </div>
  </div>

  <!-- 右上：交通規制メニュー（下段メニューの“交通規制”で開閉） -->
  <aside id="trafficPanel" aria-label="交通規制メニュー">
    <!-- ここは既存の日時指定UI等を入れて使ってください。
         このパネルを閉じても、手動指定中なら右上ヘッダー2行目に
         例「9/1 15:00〜」と表示されるよう app.js で制御しています。 -->
    <div style="color:#fff; font-weight:700; margin-bottom:6px;">交通規制メニュー</div>
    <div style="font-size:12px; opacity:.85;">
      日付や時間帯の選択UIはそのまま／またはお手持ちのものをここへ。
    </div>
  </aside>

  <!-- 左レール：インフォ・トイレ・パーキングのみ -->
  <nav id="leftRail" aria-label="地図レイヤー">
    <button class="rail-btn" id="btnInfo" type="button">
      <img src="mark/info.png" alt="インフォメーション">
      <span class="label">インフォメーション</span>
    </button>
    <button class="rail-btn" id="btnToilet" type="button">
      <img src="mark/toilet.png" alt="トイレ">
      <span class="label">トイレ</span>
    </button>
    <button class="rail-btn" id="btnParking" type="button">
      <img src="mark/parking.png" alt="パーキング">
      <span class="label">パーキング</span>
    </button>
  </nav>

  <!-- 地図 -->
  <div id="map" role="application" aria-label="地図"></div>

  <!-- 下段メニュー -->
  <footer id="bottomNav" aria-label="操作メニュー">
    <button class="nav-btn" id="navDashi" type="button" aria-label="山車へ移動">
      <img src="mark/sakura.png" alt="" />
      <div class="text">山車</div>
    </button>
    <button class="nav-btn" id="navTraffic" type="button" aria-label="交通規制メニュー">
      <!-- ご指定：下段の交通規制アイコンは no_entry.png を使う -->
      <img src="mark/no_entry.png" alt="" />
      <div class="text">交通規制</div>
    </button>
    <button class="nav-btn" id="navLocate" type="button" aria-label="現在地">
      <img src="mark/my_location.png" alt="" />
      <div class="text">現在地</div>
    </button>
    <button class="nav-btn" id="navHelp" type="button" aria-label="ヘルプ">
      <img src="mark/help.png" alt="" />
      <div class="text">ヘルプ</div>
    </button>
  </footer>

  <!-- ヘルプ（簡易） -->
  <div id="helpOverlay">
    <div class="box">
      <div style="font-weight:800; margin-bottom:6px;">ヘルプ</div>
      <div style="font-size:14px; opacity:.9;">
        ここに使い方ガイドを表示します（後から差し替えOK）。
      </div>
      <div class="close">
        <button class="btn" id="helpClose" type="button">閉じる</button>
      </div>
    </div>
  </div>

  <!-- トースト -->
  <div id="toast" role="status" aria-live="polite"></div>

  <!-- アプリ本体 -->
  <script src="./app.js"></script>

  <!-- ★Google Maps JS API★
       ※ あなたのAPIキーに差し替えてください。librariesは必要に応じて追加 -->
  <script
    src="https://maps.googleapis.com/maps/api/js?key=YOUR_GOOGLE_MAPS_API_KEY&callback=initMap&v=weekly"
    async defer></script>
</body>
</html>
