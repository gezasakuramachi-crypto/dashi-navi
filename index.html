<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>鹿嶋のご神幸 山車ナビ</title>
  <meta name="format-detection" content="telephone=no" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

  <style>
    /* ========= Base ========= */
    :root{
      --footerH: 82px;                 /* 下部フッターの高さ（アイコン＋文字） */
      --z-header: 10;
      --z-over: 20;
      --z-topmost: 30;
    }
    *{ box-sizing: border-box; }
    html, body{ height: 100%; }
    body{
      margin: 0;
      background: #000;
      color: #111;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Hiragino Kaku Gothic ProN", "Hiragino Sans", Meiryo, "Noto Sans JP", sans-serif;
      -webkit-tap-highlight-color: transparent;
    }

    /* ========= Header（タイトル帯：左寄せ・スリム） ========= */
    .app-header{
      position: fixed;
      inset: 0 0 auto 0;
      z-index: var(--z-header);
      display: flex;
      align-items: center;
      justify-content: flex-start;          /* 左寄せ */
      gap: 10px;
      padding: 4px 10px;
      background: #000;
      box-shadow: 0 2px 8px rgba(0,0,0,.25);
      -webkit-user-select: none; user-select: none;
    }
    .title-img{
      display: block;
      width: auto;
      height: auto;
      max-height: 42px;                     /* iPhone SE想定の上限 */
      object-fit: contain;
    }
    .header-spacer{
      height: 50px;                         /* タイトル高さ＋余白。端末で微調整可 */
    }
    @media (min-width: 600px){
      .title-img{ max-height: 50px; }
      .header-spacer{ height: 58px; }
    }

    /* ========= Map ========= */
    #map{
      position: fixed;
      inset: calc(50px) 0 calc(var(--footerH) + env(safe-area-inset-bottom, 0px)) 0;
      /* 上：header-spacerと同じにしておく（JSで動的にしたい場合は後述） */
    }

    /* ========= 左サイド：レイヤートグル（情報・トイレ・駐車場） ========= */
    .left-stack{
      position: fixed;
      left: 10px;
      top: calc(60px);                       /* ヘッダー下から少し余白を空ける */
      z-index: var(--z-over);
      display: flex; flex-direction: column; gap: 10px;
    }
    .stack-card{
      background: #fff; border-radius: 14px; box-shadow: 0 6px 18px rgba(0,0,0,.18);
      padding: 8px; display: grid; gap: 8px;
    }
    .stack-btn{
      width: 48px; height: 48px; border-radius: 10px;
      display: grid; place-items: center;
      background: #ffffff; border: 1px solid #e6e6e6;
    }
    .stack-btn img{ width: 36px; height: 36px; display: block; }

    /* ========= 右上：交通規制ピル ========= */
    .traffic-pill{
      position: fixed; right: 12px; top: calc(58px);
      z-index: var(--z-over);
      background: #ff2d55; color: #fff; font-weight: 700;
      padding: 8px 10px;
      border-radius: 9999px;
      box-shadow: 0 6px 18px rgba(0,0,0,.18);
      font-size: 14px;
      line-height: 1;
      cursor: pointer;
      -webkit-user-select: none; user-select: none;
    }
    .traffic-pill.small{ padding: 6px 10px; font-size: 13px; }

    /* ========= 左下：経路（ダイヤ＋矢印） ========= */
    .route-fab{
      position: fixed; left: 14px; bottom: calc(var(--footerH) + 14px + env(safe-area-inset-bottom, 0px));
      z-index: var(--z-over);
      width: 56px; height: 56px; border-radius: 16px;
      background: #0b8cff; color: #fff;
      display: grid; place-items: center;
      box-shadow: 0 10px 22px rgba(11,140,255,.35);
      font-size: 22px;
      cursor: pointer;
    }

    /* ========= 下部フッター（黒・アイコン＋文字） ========= */
    .bottom-bar{
      position: fixed; inset: auto 0 0 0; z-index: var(--z-topmost);
      height: calc(var(--footerH) + env(safe-area-inset-bottom, 0px));
      padding-bottom: env(safe-area-inset-bottom, 0px);
      background: #000; color: #fff;
      display: grid; grid-template-columns: repeat(4,1fr);
      align-items: center; gap: 0;
      border-top: 1px solid rgba(255,255,255,.08);
    }
    .nav-btn{
      display: grid; grid-template-rows: auto auto; justify-items: center; align-content: center;
      row-gap: 6px;
      padding: 8px 0;
      -webkit-user-select: none; user-select: none;
    }
    .nav-btn .icon{
      width: 38px; height: 38px; border-radius: 999px; display: grid; place-items: center;
      background: #111; border: 1px solid #222; box-shadow: inset 0 0 0 1px rgba(255,255,255,.05);
    }
    .nav-btn .icon img{ width: 28px; height: 28px; display: block; }
    .nav-btn .label{
      font-size: 12px; letter-spacing: .02em;
    }

    /* iPhone SE で「上に謎の黒帯」が出ないように固定の高さ＋セーフエリアで管理 */
    .ios-safe-pad{ padding-bottom: env(safe-area-inset-bottom, 0px); }

    /* ========= Google Maps InfoWindow を細くする（山車用カード想定） ========= */
    .gm-style .gm-style-iw-c{
      max-width: 240px !important;       /* ← 細身化：赤枠イメージ */
      padding: 8px 10px !important;
      border-radius: 14px !important;
    }
    .gm-style .gm-style-iw-d{
      overflow: auto !important;
      max-height: calc(100vh - 220px) !important;
    }

    /* 山車カードの中身微調整（app.jsのcontentで .dashi-iw を使う想定） */
    .dashi-iw .title{ font-size: 16px; font-weight: 700; margin: 0 0 6px; }
    .dashi-iw .state{ font-size: 13px; color: #555; margin: 0 0 8px; }
    .dashi-iw .chip-row{ display: grid; grid-template-columns: 1fr; gap: 8px; }
    .dashi-iw .chip{
      display:flex; align-items:center; gap:8px;
      background:#fff; border:1px solid #e6e6e6; border-radius:9999px;
      padding:10px 12px; box-shadow:0 2px 6px rgba(0,0,0,.08);
      font-size:14px; text-decoration:none; color:#111;
    }
    .dashi-iw .dot{ width: 8px; height: 8px; border-radius: 50%; background:#2b78ff; }
  </style>
</head>
<body>

  <!-- ヘッダー（左寄せ・小さめ） -->
  <div class="app-header">
    <img class="title-img"
      src="https://gezasakuramachi-crypto.github.io/dashi-navi/mark/title.png"
      alt="鹿嶋のご神幸" />
  </div>
  <div class="header-spacer"></div>

  <!-- 地図 -->
  <div id="map" role="application" aria-label="山車ナビ地図"></div>

  <!-- 左スタック（表示切替：情報・トイレ・駐車場） -->
  <div class="left-stack">
    <div class="stack-card">
      <button class="stack-btn" id="btn-info" title="インフォメーション表示/非表示">
        <img src="https://gezasakuramachi-crypto.github.io/dashi-navi/mark/info.png" alt="info" />
      </button>
      <button class="stack-btn" id="btn-toilet" title="トイレ表示/非表示">
        <img src="https://gezasakuramachi-crypto.github.io/dashi-navi/mark/toilet.png" alt="toilet" />
      </button>
      <button class="stack-btn" id="btn-parking" title="駐車場表示/非表示">
        <img src="https://gezasakuramachi-crypto.github.io/dashi-navi/mark/parking.png" alt="parking" />
      </button>
    </div>
  </div>

  <!-- 右上：交通規制ピル（日時指定時は app.js からテキスト差し替え） -->
  <button class="traffic-pill" id="traffic-pill" type="button">交通<br>規制</button>

  <!-- 左下：経路FAB（Googleマップアプリへ遷移） -->
  <button class="route-fab" id="route-fab" type="button" aria-label="山車までの経路">
    ➤
  </button>

  <!-- 下部ナビ（黒・アイコン＋文字） -->
  <nav class="bottom-bar ios-safe-pad">
    <button class="nav-btn" id="nav-dashi" type="button" aria-label="山車">
      <span class="icon"><img src="https://gezasakuramachi-crypto.github.io/dashi-navi/mark/sakura.png" alt=""></span>
      <span class="label">山車</span>
    </button>
    <button class="nav-btn" id="nav-traffic" type="button" aria-label="交通規制">
      <span class="icon"><img src="https://gezasakuramachi-crypto.github.io/dashi-navi/mark/no_entry.png" alt=""></span>
      <span class="label">交通規制</span>
    </button>
    <button class="nav-btn" id="nav-locate" type="button" aria-label="現在地">
      <span class="icon"><img src="https://gezasakuramachi-crypto.github.io/dashi-navi/mark/locate.png" alt=""></span>
      <span class="label">現在地</span>
    </button>
    <button class="nav-btn" id="nav-help" type="button" aria-label="ヘルプ">
      <span class="icon"><img src="https://gezasakuramachi-crypto.github.io/dashi-navi/mark/help.png" alt=""></span>
      <span class="label">ヘルプ</span>
    </button>
  </nav>

  <!-- メインJS（アプリ本体） -->
  <script src="./app.js"></script>

  <!-- Google Maps JS（APIキーはファイル「■■ Google API ■■.txt」にあるキーを設定） -->
  <!-- libraries: marker を併用（AdvancedMarker/Pin など） -->
  <script
    async defer
    src="https://maps.googleapis.com/maps/api/js?key=YOUR_GOOGLE_MAPS_API_KEY&libraries=marker&callback=initMap">
  </script>

  <script>
    /* 上辺（ヘッダー）と下辺（フッター）の高さが変わる端末でも
       #map のinsetをJSで最終調整する（iOSのセーフエリア考慮） */
    (function fixMapInsets(){
      const header = document.querySelector('.header-spacer');
      const footer = document.querySelector('.bottom-bar');
      const mapEl  = document.getElementById('map');
      const apply  = () => {
        const topH = header ? header.getBoundingClientRect().height : 0;
        const botH = footer ? footer.getBoundingClientRect().height : 0;
        mapEl.style.inset = `${topH}px 0 ${botH}px 0`;
      };
      window.addEventListener('resize', apply);
      window.addEventListener('orientationchange', apply);
      document.addEventListener('DOMContentLoaded', apply);
      apply();
    })();
  </script>
</body>
</html>
